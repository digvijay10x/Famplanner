generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  
}

model User {
  id                Int            @id @default(autoincrement())
  name              String
  email             String         @unique
  passwordHash      String
  createdAt         DateTime       @default(now())
  families          FamilyMember[]
  transactions      Transaction[]
  walletMemberships WalletMember[]
}

model Family {
  id         Int            @id @default(autoincrement())
  familyName String
  createdBy  Int
  createdAt  DateTime       @default(now())
  members    FamilyMember[]
  wallets    Wallet[]
  rules      ApprovalRule[]
  goals      Goal[]
  summaries  AISummary[]
}

model FamilyMember {
  id        Int       @id @default(autoincrement())
  family    Family    @relation(fields: [familyId], references: [id])
  familyId  Int
  user      User      @relation(fields: [userId], references: [id])
  userId    Int
  role      String
  invitedAt DateTime  @default(now())
  joinedAt  DateTime?
}

model Wallet {
  id            Int            @id @default(autoincrement())
  family        Family         @relation(fields: [familyId], references: [id])
  familyId      Int
  name          String
  monthlyBudget Float
  createdBy     Int
  createdAt     DateTime       @default(now())
  members       WalletMember[]
  transactions  Transaction[]
}

model WalletMember {
  wallet     Wallet @relation(fields: [walletId], references: [id])
  walletId   Int
  user       User   @relation(fields: [userId], references: [id])
  userId     Int
  permission String

  @@id([walletId, userId])
}

model Transaction {
  id        Int              @id @default(autoincrement())
  wallet    Wallet           @relation(fields: [walletId], references: [id])
  walletId  Int
  user      User             @relation(fields: [userId], references: [id])
  userId    Int
  amount    Float
  category  String
  note      String?
  status    String
  createdAt DateTime         @default(now())
  approval  PendingApproval?
}

model PendingApproval {
  id            Int         @id @default(autoincrement())
  transaction   Transaction @relation(fields: [transactionId], references: [id])
  transactionId Int         @unique
  requestedBy   Int
  reviewedBy    Int?
  decision      String?
  reviewedAt    DateTime?
}

model ApprovalRule {
  id       Int     @id @default(autoincrement())
  family   Family  @relation(fields: [familyId], references: [id])
  familyId Int
  ruleType String
  value    String
  isActive Boolean @default(true)
}

model Goal {
  id            Int      @id @default(autoincrement())
  family        Family   @relation(fields: [familyId], references: [id])
  familyId      Int
  name          String
  targetAmount  Float
  currentAmount Float    @default(0)
  targetDate    DateTime
}

model AISummary {
  id          Int      @id @default(autoincrement())
  family      Family   @relation(fields: [familyId], references: [id])
  familyId    Int
  summaryText String
  generatedAt DateTime @default(now())
}
